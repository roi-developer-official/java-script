(()=>{let t=new class{initSelectors(){this.board=document.querySelector(".board"),this.container=document.querySelector(".container"),this.cols=this.container.querySelectorAll("div ul"),this.diceBtn=document.querySelector(".dice-btn"),this.diceDivs=document.querySelector(".dice"),this.dropTitle=document.querySelector(".drop-title"),this.dropBlackPalette=document.querySelector(".out-black-tools"),this.eateanConteiner=document.querySelector(".eaten-container"),this.dropWhiteContanier=document.querySelector(".out-white-tools"),this.startNewGameDiv=document.querySelector(".start-new-game"),this.winP=document.querySelector(".win"),this.startNewBtn=document.querySelector(".start-new-btn"),this.startPlayBtn=document.querySelector(".start-play"),this.instructionDiv=document.querySelector(".instructions")}initListeners(){this.startPlayBtn.addEventListener("click",(()=>{this.instructionDiv.style.visibility="hidden"})),this.diceBtn.addEventListener("click",this.genrateRandomNumbers.bind(this)),this.dropWhiteContanier.addEventListener("dragover",(t=>{t.preventDefault()})),this.startNewBtn.addEventListener("click",(()=>{this.init()})),this.dropWhiteContanier.addEventListener("drop",(t=>{this.playerTurn&&this.isAllHousePlayer()&&this.handlerOutMovment()})),this.container.addEventListener("dragstart",(t=>{"white-tool"===t.target.classList[1]&&(t.dataTransfer.effectAllowed="copyMove",this.dragged=t.target.parentElement)})),this.container.addEventListener("dragover",(t=>{t.preventDefault()})),this.cols.forEach((t=>{t.addEventListener("drop",(e=>{e.preventDefault(),this.playerTurn&&(this.dropped=t,this.handlePlayerMovment())}))}))}init(){this.initCols(),this.startNewGameDiv.style.visibility="hidden",this.diceDivs.children[0].style.visibility="hidden",this.diceDivs.children[1].style.visibility="hidden",this.diceBtn.removeAttribute("disabled",!0),this.playerToolCount=15,this.oppenentToolsCount=15,this.playerTurn=!1,this.countMove=0,this.doubleFlag=!0,this.playerEatenCount=0,this.oppenentEatenCount=0,this.dropped=null,this.dragged=null,this.num1=null,this.num2=null}handlePlayerMovment(){let t;this.playerEatenCount?(t=this.validatePlayerMoveWhenEaten(),t&&this.handleDragAndDropWhileEaten()):(t=this.validatePlayerMove(),t&&this.handleDragAndDrop())}enableDiceButton(){this.num1=null,this.num2=null,this.diceBtn.removeAttribute("disabled",!0)}isAllHousePlayer(){let t=this.getEmptyAndWhiteCols(),e=0;if(t=t.filter((t=>+t.id<7)).filter((t=>t.children[0]&&"white-tool"===t.children[0].classList[1])),this.playerEatenCount)return!1;for(let i of t)e+=i.children.length;return e===this.playerToolCount}getWhiteCols(){let t=[];for(let e of this.cols)e.children.length>0&&"white-tool"===e.children[0].classList[1]&&t.push(e);return t}moveOutPlayerTool(){let t=this.createOutTool("green");return this.dropWhiteContanier.append(t),this.dragged.removeChild(this.dragged.children[0]),this.playerToolCount--,this.countMove++,this.checkForWin()}handlerOutMovment(){let t,e=this.getWhiteCols().sort(((t,e)=>e.id-t.id)),i=this.getEmptyAndBlackCols().filter((t=>+t.id<7)).filter((t=>t.children.length>0));e=e.filter((t=>+t.id<7));let n=+this.dragged.id;if(this.num1===n){if(t=this.moveOutPlayerTool(),t)return;this.tempNum1=this.num1,this.num1=null}else if(this.num2===n){if(t=this.moveOutPlayerTool(),t)return;this.tempNum2=this.num2,this.num2=null}else{this.num1=this.num1||this.tempNum1,this.num2=this.num2||this.tempNum2;for(let i of e)if(i.children.length){if(this.num1>+i.id&&n===+i.id){if(t=this.moveOutPlayerTool(),t)return;break}if(this.num2>+i.id&&n===+i.id){if(t=this.moveOutPlayerTool(),t)return;break}break}}return 2===this.countMove&&!this.isDouble||4===this.countMove&&this.isDouble||i.length&&!this.checkForNoActionOnPlayerHouse()?(this.countMove=0,void this.switchTurn()):void(this.isDouble&&(this.num1=this.tempNum1,this.num2=this.tempNum2))}checkForNoActionOnPlayerHouse(){let t=this.getEmptyAndWhiteCols().filter((t=>t.id<7)),e=this.getWhiteCols().filter((t=>t.id<7));e=e.sort(((t,e)=>e.id-t.id));let i=t.filter((t=>+t.id===this.num1));if(i=i[0],i&&i.children.length>0)return!0;if(i=t.filter((t=>+t.id===this.num2)),i=i[0],i&&i.children.length>0)return!0;for(let t of e)if(t.children.length>0){if(+t.id-this.num1<=0||+t.id-this.num2<=0)return!0;break}for(let i of e){let e=+i.id,n=this.num1&&t.filter((t=>+t.id==e-this.num1)),s=this.num2&&t.filter((t=>+t.id==e-this.num2));if(n&&n.length||s&&s.length)return!0}return!1}removeChildrens(t){for(;t.firstChild;)t.removeChild(t.firstChild)}initCols(){this.removeChildrens(this.dropBlackPalette),this.removeChildrens(this.eateanConteiner),this.removeChildrens(this.dropWhiteContanier),this.cols.forEach((t=>{t.children.length&&this.removeChildrens(t)})),this.cols.forEach((t=>{switch(t.id<13&&(t.style.justifyContent="flex-end"),+t.id){case 1:this.fillCols(2,t,"black");break;case 6:this.fillCols(5,t,"green");break;case 8:this.fillCols(3,t,"green");break;case 12:this.fillCols(5,t,"black");break;case 13:this.fillCols(5,t,"green");break;case 17:this.fillCols(3,t,"black");break;case 19:this.fillCols(5,t,"black");break;case 24:this.fillCols(2,t,"green")}}))}genrateRandomNumbers(){if(this.diceBtn.setAttribute("disabled",!0),this.num1=Math.floor(6*Math.random()+1),this.countMove=0,this.diceDivs.children[0].src=`./images/${this.num1}-dice.svg`,this.diceDivs.children[0].style.visibility="visible",this.num2=Math.floor(6*Math.random()+1),this.diceDivs.children[1].src=`./images/${this.num2}-dice.svg`,this.diceDivs.children[1].style.visibility="visible",this.playerTurn=!this.playerTurn,this.tempNum1=this.num1,this.tempNum2=this.num2,this.playerTurn)if(this.playerEatenCount)this.checkForNoActionOnEatenPlayer()||setTimeout((()=>{this.switchTurn()}),300);else if(this.isAllHousePlayer()){if(!this.checkForNoActionOnPlayerHouse())return void this.switchTurn()}else this.checkForNoActionOnPlayer(this.num1)||this.checkForNoActionOnPlayer(this.num2)||setTimeout((()=>{this.switchTurn()}),300);this.num1===this.num2?(this.isDouble=!0,this.doubleFlag=!0):this.isDouble=!1}checkForWin(){return 0===this.oppenentToolsCount?(this.startNewGameDiv.style.visibility="visible",this.winP.textContent="You Lose!",!0):0===this.playerToolCount&&(this.startNewGameDiv.style.visibility="visible",this.winP.textContent="You Win!",!0)}fillCols(t,e,i){for(let n=0;n<t;n++){let t=this.createTool(i);e.appendChild(t)}}createTool(t){let e=document.createElement("li");return e.style.backgroundColor=t,e.classList.add("tool"),"green"===t?(e.classList.add("white-tool"),e.setAttribute("draggable",!0)):e.classList.add("black-tool"),e}validatePlayerMove(){const t=+this.dropped.id,e=+this.dragged.id,i=t<=e;let n=this.dropped.children;const s=e-t===this.num1||e-t===this.num2;return n=!!(n[0]&&"black-tool"===n[0].classList[1]&&n.length>1),!(!i||n||!s)}validatePlayerMoveWhenEaten(){const t=+this.dropped.id;let e,i,n,s=this.getColById(this.cols,t);return e=0===s.children.length,i=!e&&"white-tool"===s.children[0].classList[1],n=!e&&"black-tool"===s.children[0].classList[1]&&1===s.children.length,!!((e||i||n)&&t>18)}checkForNoActionOnPlayer(t){let e=this.getEmptyAndWhiteCols(),i=e.filter((t=>t.children.length>0&&"white-tool"===t.children[0].classList[1]));for(let n=0;n<i.length;n++){let s=+i[n].id;if(e.filter((e=>+e.id==s-t)).length)return!0}return!1}checkForNoActionOnEatenPlayer(){let t=this.getEmptyAndWhiteCols();t=t.filter((t=>+t.id>18));for(let e=0;e<t.length;e++){let i=24-+t[e].id+1;if(i===this.num1||i===this.num2)return!0}return!1}checkForAllToolInHousePlayer(){let t=[],e=0;for(let e of this.cols)+e.id<7&&t.push(e);for(let i of t)i.children.length>0&&"white-tool"===i.children[0].classList[1]&&(e+=i.children.length);return e===this.playerToolCount}checkForAllToolInHouseOpponent(){let t=[],e=0;for(let e of this.cols)+e.id>18&&t.push(e);for(let i of t)i.children.length>0&&"black-tool"===i.children[0].classList[1]&&(e+=i.children.length);return e===this.oppenentToolsCount}handleDragAndDropWhileEaten(){const t=24-+this.dropped.id+1;let e=this.num1,i=this.num2;if(t!==this.num1&&t!==this.num2||this.dropped.children.length&&"black-tool"===this.dropped.children[0].classList[1]&&(this.oppenentEatenCount++,this.dropped.removeChild(this.dropped.children[0]),this.addEatenToContainer("black")),t===this.num1){this.countMove++,this.num1=null,this.playerEatenCount--;let t=this.createTool("green");this.dropped.append(t),this.removeEatenFromContainer("green")}else if(t===this.num2){this.countMove++,this.num2=null,this.playerEatenCount--;let t=this.createTool("green");this.dropped.append(t),this.removeEatenFromContainer("green")}return this.isDouble&&4===this.countMove||!this.isDouble&&2===this.countMove?(this.switchTurn(),void(this.countMove=0)):0!==this.playerEatenCount||this.checkForNoActionOnPlayer(this.num1)||this.checkForNoActionOnPlayer(this.num2)?!this.checkForNoActionOnEatenPlayer()&&this.playerEatenCount?(this.switchTurn(),void(this.countMove=0)):void(this.isDouble&&(this.num1=e,this.num2=i)):(this.countMove=0,void this.switchTurn())}getEmptyAndWhiteCols(){let t=[];for(let e=0;e<this.cols.length;e++)(this.cols[e].children.length>0&&"white-tool"===this.cols[e].children[0].classList[1]||1===this.cols[e].children.length||0===this.cols[e].children.length)&&t.push(this.cols[e]);return t.sort(((t,e)=>t.id-e.id))}switchTurn(){setTimeout((()=>{this.genrateRandomNumbers(),this.opponentMove()}),300)}handleDragAndDrop(){const t=+this.dropped.id,e=+this.dragged.id;let i=this.num1,n=this.num2;this.dropped&&1===this.dropped.children.length&&"black-tool"===this.dropped.children[0].classList[1]&&(this.eatanHandler("black",this.dropped),this.oppenentEatenCount++);let s=this.createTool("green");if(this.dragged.removeChild(this.dragged.children[0]),this.dropped.appendChild(s),e-t===this.num1?(this.num1=null,this.countMove++):e-t===this.num2&&(this.num2=null,this.countMove++),this.isDouble&&4===this.countMove||!this.isDouble&&2===this.countMove)return this.countMove=0,void this.switchTurn();this.isDouble&&4!==this.countMove&&(this.num1=i,this.num2=n);const l=this.isAllHousePlayer();if(l){if(!this.checkForNoActionOnPlayerHouse())return this.countMove=0,void this.switchTurn()}else if(!l&&!(this.checkForNoActionOnPlayer(this.num1)&&this.checkForNoActionOnPlayer(this.num2)||this.playerEatenCount))return this.countMove=0,void this.switchTurn()}createOutTool(t){let e=document.createElement("div");return e.classList.add("out-tool"),e.style.background=t,e}moveOppenent(t,e){t.children.length&&"white-tool"===t.children[0].classList[1]&&(this.playerEatenCount++,this.addEatenToContainer("green"),t.removeChild(t.children[0])),this.dragged=e,this.dropped=t,this.handleOppenentMovment(),this.countMove++}allHouseOppenetMove(){let t=this.getBlackCols();t=t.filter((t=>+t.id>18));let e,i=this.getEmptyBlackAndOnesWhiteCols().filter((t=>+t.id>18)),n=!0,s=!0,l=this.num1,h=this.num2;if(this.isDouble&&4===this.countMove||!this.isDouble&&2===this.countMove)return void this.enableDiceButton();let o=24-this.num1+1,r=t.filter((t=>+t.id===o));if(r=r[0],!r)for(let e of t)if(e.children.length>0){+e.id<o?(s=!1,r=e):(s=!0,r=e);break}if(s&&r){r.removeChild(r.children[0]);let i=this.createOutTool("black");if(this.dropBlackPalette.append(i),this.oppenentToolsCount--,e=this.checkForWin(),e)return;this.countMove++,t=this.getBlackCols().filter((t=>+t.id>18))}if(o=24-this.num2+1,r=t.filter((t=>+t.id===o)),r&&(s=!0),r=r[0],!r)for(let e of t)if(e.children.length>0){+e.id<o?(s=!1,r=e):(s=!0,r=e);break}if(s&&r){r.removeChild(r.children[0]);let n=this.createOutTool("black");if(this.dropBlackPalette.append(n),this.oppenentToolsCount--,e=this.checkForWin(),e)return;this.countMove++,t=this.getBlackCols().filter((t=>+t.id>18)),i=this.getEmptyBlackAndOnesWhiteCols().filter((t=>+t.id>18))}if(!this.isDouble&&2===this.countMove||this.isDouble&&4===this.countMove)this.enableDiceButton();else{if(this.isDouble&&this.doubleFlag&&(this.doubleFlag=!1,this.num1=l,this.num2=h,this.allHouseOppenetMove()),this.checkForOppnentMovmentAbility())if(this.isDouble&&this.countMove<4){this.num1=l,this.num2=h;for(let e of t){let s=+e.id;for(let l of i){let h=+l.id;(s+this.num1===h&&n||s+this.num2===h&&n)&&(this.moveOppenent(l,e),n=!1,t=this.getBlackCols().filter((t=>+t.id>18)),i=this.getEmptyBlackAndOnesWhiteCols().filter((t=>+t.id>18)),this.allHouseOppenetMove())}}}else if(!this.isDouble&&this.countMove<2){n=!0;for(let e of t){let s=+e.id;for(let l of i){let h=+l.id;(this.num1&&s+this.num1===h&&n||this.num2&&s+this.num2===h&&n)&&(this.moveOppenent(l,e),t=this.getBlackCols().filter((t=>+t.id>18)),i=this.getEmptyBlackAndOnesWhiteCols().filter((t=>+t.id>18)),this.allHouseOppenetMove(),n=!1)}}}this.isDouble&&this.doubleFlag&&(this.doubleFlag=!1,this.num1=l,this.num2=h,this.allHouseOppenetMove()),this.enableDiceButton()}}checkForOppnentMovmentAbility(){let t=this.getEmptyBlackAndOnesWhiteCols(),e=this.getBlackCols();for(let i of e){let e=+i.id;for(let i of t){let t=+i.id;if(e+this.num1===t||e+this.num2===t)return!0}}return!1}getEmptyBlackAndOnesWhiteCols(){let t=[];for(let e of this.cols){let i=e.children;(0===i.length||1===i.length&&"white-tool"===i[0].classList[1]||i.length>0&&"black-tool"===i[0].classList[1])&&t.push(e)}return t}opponentMove(){let t=this.checkForNoActionOnOpponent(this.num1)||this.checkForNoActionOnOpponent(this.num2),e=this.checkForNoActionWhilteEatenOppenent();if(this.oppenentEatenCount){if(!e)return void this.enableDiceButton();this.checkForEmptyWhenEaten()}else if(this.checkForAllToolInHouseOpponent())this.allHouseOppenetMove(),this.countMove=0;else{if(!t)return void this.enableDiceButton();this.chackforEmpty(),this.countMove=0}}getBlackCols(){let t=[];for(let e=0;e<this.cols.length;e++)this.cols[e].children&&this.cols[e].children[0]&&"black-tool"===this.cols[e].children[0].classList[1]&&t.push(this.cols[e]);return t.sort(((t,e)=>t.id-e.id))}getEmptyAndBlackCols(){let t=[];for(let e=0;e<this.cols.length;e++)(0===this.cols[e].children.length||"black-tool"===this.cols[e].children[0].classList[1]||"white-tool"===this.cols[e].children[0].classList[1]&&1===this.cols[e].children.length)&&t.push(this.cols[e]);return t.sort(((t,e)=>t.id-e.id))}getWhiteOnesCols(){let t=[];for(let e=0;e<this.cols.length;e++)this.cols[e].children[0]&&1===this.cols[e].children.length&&"white-tool"===this.cols[e].children[0].classList[1]&&t.push(this.cols[e]);return t}handleOppenentMovment(){let t=this.createTool("black");this.dragged.removeChild(this.dragged.children[0]),this.dropped.appendChild(t)}eatPlayerWhenEaten(t){this.playerEatenCount++,this.removeEatenFromContainer("black");let e=this.createTool("black"),i=this.createTool("green");return t.removeChild(t.children[0]),this.eateanConteiner.append(i),t.append(e),t=(t=this.getWhiteOnesCols()).filter((t=>t.id<=6)),this.oppenentEatenCount--,t}putToolOutFromEaten(t){this.removeEatenFromContainer("black");let e=this.createTool("black");t.append(e),this.oppenentEatenCount--}checkForNoActionOnOpponent(t){let e=this.getEmptyAndBlackCols(),i=e.filter((t=>t.children.length>0&&"black-tool"===t.children[0].classList[1]));for(let n=0;n<i.length;n++){let s=+i[n].id;if(e.filter((e=>+e.id===s+t)).length)return!0}return!1}checkForNoActionWhilteEatenOppenent(){let t=this.getEmptyAndBlackCols().filter((t=>+t.id<7));for(let e of t){let t=+e.id;if(t===this.num1||t===this.num2)return!0}return!1}checkForEmptyWhenEaten(){let t=this.getEmptyAndBlackCols(),e=this.getWhiteOnesCols();t=t.filter((t=>t.id<=6)),e=e.filter((t=>+t.id<=6));let i,n=this.num1,s=this.num2;for(let t=0;t<e.length&&this.oppenentEatenCount;t++)this.num1===+e[t].id&&this.oppenentEatenCount?(e=this.eatPlayerWhenEaten(e[t]),this.num1=null):this.num2===+e[t].id&&this.oppenentEatenCount&&(e=this.eatPlayerWhenEaten(e[t]),this.num2=null);if(this.num1||this.num2||this.isDouble){if(this.oppenentEatenCount)for(let e=0;e<t.length&&(this.num1!==+t[e].id||(this.putToolOutFromEaten(t[e]),this.num1=null,0!==this.oppenentEatenCount))&&(this.num2!==+t[e].id||(this.putToolOutFromEaten(t[e]),this.num2=null,0!==this.oppenentEatenCount));e++);if(i=this.checkForNoActionWhilteEatenOppenent(),i||!this.oppenentEatenCount){if(this.isDouble)this.isDouble=!1,this.oppenentEatenCount?(this.num1=n,this.num2=s,this.checkForEmptyWhenEaten()):!this.num1&&this.num2?(this.num1=n,this.chackforEmpty(),this.num1=null,this.num2=s,this.chackforEmpty()):!this.num2&&this.num1?(this.num2=s,this.chackforEmpty(),this.num2=null,this.num1=n,this.chackforEmpty()):this.num1||this.num2||(this.num1=n,this.num2=s,this.chackforEmpty());else if(!this.isDouble&&!this.oppenentEatenCount){if(!this.num1&&!this.num2)return void this.enableDiceButton();this.chackforEmpty()}}else this.enableDiceButton()}else this.enableDiceButton()}addEatenToContainer(t){let e=this.createTool(t);this.eateanConteiner.append(e)}removeEatenFromContainer(t){let e=this.eateanConteiner.children;for(let i of e)if(i.style.backgroundColor===t)return void i.parentElement.removeChild(i)}oppenentEatPlayer(t,e){let i;return this.playerEatenCount++,this.eatanHandler("green",e),this.dragged=t,this.dropped=e,this.handleOppenentMovment(),i=this.getBlackCols(),i}chackforEmpty(){let t=this.getEmptyAndBlackCols(),e=this.getBlackCols(),i=this.getWhiteOnesCols(),n=this.num1,s=this.num2;for(let i=0;i<e.length&&this.num1;i++){let n=+e[i].id,s=n+this.num1;if(n+this.num1>=25&&this.checkForAllToolInHouseOpponent()){this.allHouseOppenetMove();break}let l=this.getColById(t,s);if(l){1===l.children.length&&"white-tool"===l.children[0].classList[1]&&(this.playerEatenCount++,this.eatanHandler("green",l)),this.dragged=this.getColById(e,n),this.dropped=l,this.handleOppenentMovment(),this.num1=null;break}}e=this.getBlackCols();for(let t=0;t<e.length;t++){let n=+e[t].id;for(let s=0;s<i.length;s++){let l=+i[s].id;if(this.num1&&n+this.num1===l){if(e=this.oppenentEatPlayer(e[t],i[s]),this.num1=null,0===this.playerEatenCount)break}else if(this.num2&&n+this.num2===l&&(e=this.oppenentEatPlayer(e[t],i[s]),this.num2=null,0===this.playerEatenCount))break}}e=this.getBlackCols();for(let i=0;i<e.length&&this.num2;i++){let n=+e[i].id,s=n+this.num2,l=this.getColById(t,s);if(n+this.num2>=25&&this.checkForAllToolInHouseOpponent()){this.allHouseOppenetMove();break}if(l){1===l.children.length&&"white-tool"===l.children[0].classList[1]&&(this.eatanHandler("green",l),this.playerEatenCount++),this.dropped=l,this.dragged=this.getColById(e,n),this.num2=null,this.handleOppenentMovment();break}}for(let t=0;t<e.length;t++){let n=+e[t].id;for(let s=0;s<i.length;s++){let l=+i[s].id;if(this.num1&&n+this.num1===l){if(e=this.oppenentEatPlayer(e[t],i[s]),this.num1=null,0===this.playerEatenCount)break}else if(this.num2&&n+this.num2===l&&(e=this.oppenentEatPlayer(e[t],i[s]),this.num2=null,0===this.playerEatenCount))break}}e=this.getBlackCols();for(let i=0;i<e.length&&this.num1;i++){let n=+e[i].id,s=n+this.num1,l=this.getColById(t,s);if(n+this.num1>=25&&this.checkForAllToolInHouseOpponent()){this.allHouseOppenetMove();break}if(l){l&&1===l.children.length&&"white-tool"===l.children[0].classList[1]&&(this.eatanHandler("green",l),this.playerEatenCount++),this.dragged=this.getColById(e,n),this.dropped=l,this.handleOppenentMovment(),this.num2=null;break}}this.isDouble&&!this.checkForAllToolInHouseOpponent()&&(this.isDouble=!1,this.num1=n,this.num2=s,this.chackforEmpty()),this.isDouble||this.enableDiceButton()}eatanHandler(t,e){let i=this.createTool(t);e.removeChild(e.children[0]),this.eateanConteiner.append(i)}getColById(t,e){for(let i=0;i<t.length;i++)if(+t[i].id===e)return t[i];return null}};t.initSelectors(),t.initListeners(),t.init()})();